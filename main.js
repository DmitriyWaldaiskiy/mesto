(()=>{"use strict";const e=document.querySelector(".profile__button"),t=document.querySelector(".profile__add-button"),s=document.querySelector(".profile__avatar-overlay"),r=document.querySelector(".profileForm"),i=document.querySelector(".addform"),n=document.querySelector(".avatarform"),o={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button-submit",inactiveButtonClass:"popup__button-submit_off",inputErrorClass:"popup__input_invalid",errorClass:"popup__input-error"};class a{constructor(e,t,s,r,i){this._cardData=e,this._link=e.link,this._name=e.name,this._myId=e.myid,this._likes=e.likes,this._likesLength=e.likes.length,this._likeChange=i,this._isLike=!1,this._ownerId=e.owner._id,this._cardId=e._id,this._openImage=s,this._openDeletePopup=r,this._cardElement=document.querySelector(t).content.querySelector(".element").cloneNode(!0),this._cardImage=this._cardElement.querySelector(".element__images"),this._cardName=this._cardElement.querySelector(".element__heading"),this._deleteButton=this._cardElement.querySelector(".element__button-delete"),this._likeButton=this._cardElement.querySelector(".element__like"),this._counter=this._cardElement.querySelector(".element__counter")}_handleDelete=()=>{this._openDeletePopup({card:this,cardId:this._cardId})};_handleLike=()=>{this._likeChange(this._isLike,this._cardId)};_onOpenImage=()=>{this._openImage(this._cardData)};_setEventListener=()=>{this._deleteButton.addEventListener("click",this._handleDelete),this._likeButton.addEventListener("click",this._handleLike),this._cardImage.addEventListener("click",this._onOpenImage)};_setTrashButtonVisible(){this._myId===this._ownerId?this._deleteButton.style.display="block":this._deleteButton.style.display="none"}checkStatusLike(){this._likes.forEach((e=>{if(e._id===this._myId)return this._isLike=!0,void this._likeButton.classList.add("element__like_active")})),this._counter.textContent=this._likesLength}toggleLikes(e){this._likeButton.classList.toggle("element__like_active"),this._counter.textContent=e.length,this._isLike?this._isLike=!1:this._isLike=!0}removeCard(){this._cardElement.remove()}createCardElement(){return this._cardImage.src=this._link,this._cardImage.alt=this._name,this._cardName.textContent=this._name,this.checkStatusLike(),this._setTrashButtonVisible(),this._setEventListener(),this._cardElement}}class h{constructor(e,t){this._form=t,this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector)),this._buttonElement=this._form.querySelector(this._submitButtonSelector)}_showError=e=>{this._errorElement=this._form.querySelector(`.${e.id}-error`),e.classList.add(this._inputErrorClass),this._errorElement.textContent=e.validationMessage,this._errorElement.classList.add(this._errorClass)};_hideError=e=>{this._errorElement=this._form.querySelector(`.${e.id}-error`),e.classList.remove(this._inputErrorClass),this._errorElement.classList.remove(this._errorClass),this._errorElement.textContent=""};_checkInputValidity=e=>{e.validity.valid?this._hideError(e):this._showError(e)};_hasInvalidInput=()=>this._inputList.some((e=>!e.validity.valid));deactivateButton=()=>{this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)};_activateButton=()=>{this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled",!0)};_toggleButtonState=()=>{this._hasInvalidInput()?this.deactivateButton():this._activateButton()};_setEventListeners=()=>{this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))};enableValidation=()=>{this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}class l{constructor(e){this._popup=document.querySelector(e),this._popupCloseBtn=this._popup.querySelector(".popup__close-icon")}_handleEsc=e=>{"Escape"===e.key&&this.close()};_handleCloseBtn=()=>{this.close()};_handleOverlay=e=>{e.target===e.currentTarget&&this.close()};setEventListeners(){this._popupCloseBtn.addEventListener("click",this._handleCloseBtn),this._popup.addEventListener("click",this._handleOverlay)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEsc)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEsc)}}class c extends l{constructor(e,t){super(e),this._functionSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._inputList=this._form.querySelectorAll(".popup__input"),this._submitButton=this._form.querySelector(".popup__button-submit"),this._defaulTextButton=this._submitButton.textContent}_getInputsValue(){return this._values={},this._inputList.forEach((e=>{this._values[e.name]=e.value})),this._values}setInputsValue(e){this._inputList.forEach((t=>{t.value=e[t.name]}))}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._submitButton.textContent=`${this._submitButton.textContent}...`,this._functionSubmit(this._getInputsValue())}))}setupTextDefault(){this._submitButton.textContent=this._defaulTextButton}close(){super.close(),this._form.reset()}}const _=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers,this._autorization=e.headers.authorization}_checkResponse(e){return e.ok?e.json():Promise.reject}getProfileInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}getCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}setUserInfo(e){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.username,about:e.job})}).then(this._checkResponse)}setNewAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.avatar})}).then(this._checkResponse)}addCard(e){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e.place,link:e.link})}).then(this._checkResponse)}addLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}deleteLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-69",headers:{authorization:"35a16b25-9e84-4733-9ede-57421d5630ff","Content-Type":"application/json"}}),u=new class{constructor(e){this._profileName=document.querySelector(e.profileNameSelector),this._profileJob=document.querySelector(e.profileJobSelector),this._profileAvatar=document.querySelector(e.profileAvatar)}getUserInfo(){return{username:this._profileName.textContent,job:this._profileJob.textContent,avatar:this._profileAvatar.src}}setUserInfo({username:e,job:t,avatar:s}){this._profileName.textContent=e,this._profileJob.textContent=t,this._profileAvatar.src=s}getId(){return this._id}setId(e){this._id=e}}({profileNameSelector:".profile__title",profileJobSelector:".profile__subtitle",profileAvatar:".profile__avatar"}),d=new class extends l{constructor(e){super(e),this._popupImage=this._popup.querySelector(".popup__image"),this._imageCaption=this._popup.querySelector(".popup__caption-image")}open=e=>{this._popupImage.src=e.link,this._popupImage.alt=e.place,this._imageCaption.textContent=`На фото ${e.name}`,super.open()}}(".popup_image-zoom"),p=new class extends l{constructor(e,t){super(e),this._functionSubmit=t}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(e=>{e.preventDefault(),this._functionSubmit({card:this._element,cardId:this._cardId})}))}open=({card:e,cardId:t})=>{super.open(),this._element=e,this._cardId=t}}(".popup-delete",(({card:e,cardId:t})=>{_.deleteCard(t).then((()=>{e.removeCard(),p.close()})).catch((e=>console.error(`Ошибка при удалении карточек ${e}`)))}));function m(e){const t=new a(e,".cards-template",d.open,p.open,((e,s)=>{e?_.deleteLike(s).then((e=>{t.toggleLikes(e.likes)})).catch((e=>console.error(`Ошибка при снятии лайков ${e}`))):_.addLike(s).then((e=>{t.toggleLikes(e.likes)})).catch((e=>console.error(`Ошибка при добавлении лайков ${e}`)))}));return t.createCardElement()}const f=new class{constructor(e,t){this._container=document.querySelector(t),this._renderer=e}addCards(e){e.forEach((e=>{this._renderer(e)}))}addItemPrepend(e){this._container.prepend(e)}addItemAppend(e){this._container.append(e)}}((e=>{f.addItemAppend(m(e))}),".elements");e.addEventListener("click",(()=>{v.setInputsValue(u.getUserInfo()),v.open()}));const v=new c(".popup_profile",(e=>{_.setUserInfo(e).then((e=>{u.setUserInfo({username:e.name,job:e.about,avatar:e.avatar}),v.close()})).catch((e=>console.error(`Ошибка редактирования профиля ${e}`))).finally((()=>v.setupTextDefault()))}));t.addEventListener("click",(()=>{k.deactivateButton(),E.open()}));const E=new c(".popup_add",(e=>{_.addCard(e).then((e=>{e.myid=u.getId(),f.addItemPrepend(m(e)),E.close()})).catch((e=>console.error(`Ошибка редактирования профиля ${e}`))).finally((()=>E.setupTextDefault()))}));s.addEventListener("click",(()=>{L.deactivateButton(),b.open()}));const b=new c(".popup-avatar-edit",(e=>{_.setNewAvatar(e).then((e=>{u.setUserInfo({username:e.name,job:e.about,avatar:e.avatar}),b.close()})).catch((e=>console.error(`Ошибка редактирования аватара ${e}`))).finally((()=>b.setupTextDefault()))}));v.setEventListeners(),d.setEventListeners(),E.setEventListeners(),b.setEventListeners(),p.setEventListeners(),new h(o,r).enableValidation();const k=new h(o,i);k.enableValidation();const L=new h(o,n);L.enableValidation(),Promise.all([_.getProfileInfo(),_.getCards()]).then((([e,t])=>{t.forEach((t=>t.myid=e._id)),u.setUserInfo({username:e.name,job:e.about,avatar:e.avatar}),u.setId(e._id),f.addCards(t)})).catch((e=>console.error(`Ошибка редактирования профиля ${e}`)))})();